<%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"  %>
<div id="places"></div>
<!-- google map 描画位置 -->
<div id="map-canvas"></div>

<script>

function initialize() {
  var mapOptions = {
    zoom: 13,
    center: new google.maps.LatLng(-25.363882,131.044922)
  }
  
  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  
  //Ajax
  $.ajax({
    url: "/parking/show"
  }).done(function(data){
    $.each(data.places, function(){
      $.each(this, function(){
        var marker = new google.maps.Marker({
          position: new google.maps.LatLng(this["http://www.w3.org/2003/01/geo/wgs84_pos#lat"][0]["value"], this["http://www.w3.org/2003/01/geo/wgs84_pos#long"][0]["value"]),
          map: map,
          title: this["http://smartercity.jp/ug#title"][0]["value"]
        });
      });
    });
  }).fail(function(data){
    console.log('ajax error');
  });
}

google.maps.event.addDomListener(window, 'load', initialize);

</script>